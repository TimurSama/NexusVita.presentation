# TODO: План доработки EthosLife до полной готовности — Версия 2.0

**Для:** Самого себя (AI-разработчика)  
**Дата создания:** 2026-02-18  
**Цель:** Довести приложение до полнофункционального состояния с учетом всех дополнений  
**Временной горизонт:** 3-4 месяца  

---

## 🎯 ОБНОВЛЕННАЯ КОНЦЕПЦИЯ

### Главная мысль
**"Здоровье — это ежедневная привычка"**

### Экосистема включает:
- **7 модулей здоровья** (Медицина, Движение, Питание, Психология, Сон, Отношения, Привычки/Духовность)
- **Единый центр управления** (дашборд) с подключением специалистов
- **Автоматическую систему выплат** всем участникам (процент/фикс, настраивается)
- **Токеномику** — Unity токен (офчейн), с выгодой при оплате токенами
- **Социальную сеть** с лентой публикаций (Instagram-style)

### Тарифные планы (обновлены)
| План | Цена | Целевая аудитория |
|------|------|-------------------|
| **Free** | $0 | Базовый функционал, 3 модуля |
| **Basic** | $20/мес | Все модули, базовый ИИ |
| **Premium** | $50/мес | Всё + специалисты + премиум фичи |

**Важно:** Подключение специалиста — оплачивается напрямую специалисту (комиссия платформы 5%)

---

## 🔴 ФАЗА 1: ИНФРАСТРУКТУРА И АУТЕНТИФИКАЦИЯ (Недели 1-2)

### 1.1 База данных PostgreSQL (Supabase)

#### Таблицы пользователей
- [ ] **DB-001** `users` — базовая информация, роль, тариф
- [ ] **DB-002** `user_profiles` — профиль, настройки, публичная страница
- [ ] **DB-003** `user_wallets` — кошельки (фиат + крипто + Unity токен)
- [ ] **DB-004** `user_sessions` — сессии, JWT токены
- [ ] **DB-005** `user_social` — социальная информация, подписчики

#### Таблицы модулей здоровья (ВСЕ 7)
- [ ] **DB-006** `health_medicine` — медицинские данные, анализы
- [ ] **DB-007** `health_movement` — тренировки, активность
- [ ] **DB-008** `health_nutrition` — питание, дневник
- [ ] **DB-009** `health_psychology` — настроение, дневник мыслей
- [ ] **DB-010** `health_sleep` — сон, фазы
- [ ] **DB-011** `health_relationships` — социальные связи
- [ ] **DB-012** `health_habits` — привычки, стрики

#### Таблицы платежей и подписок
- [ ] **DB-013** `subscriptions` — подписки пользователей
- [ ] **DB-014** `payments` — история платежей
- [ ] **DB-015** `payouts` — выплаты партнерам/специалистам
- [ ] **DB-016** `commission_settings` — настройки комиссий

#### Таблицы токеномики
- [ ] **DB-017** `unity_tokens` — баланс токенов
- [ ] **DB-018** `token_transactions` — история транзакций
- [ ] **DB-019** `token_exchange_rates` — курсы обмена

#### Таблицы специалистов и центров
- [ ] **DB-020** `specialists` — профили специалистов
- [ ] **DB-021** `centers` — профили центров
- [ ] **DB-022** `specialist_plans` — тарифы специалистов
- [ ] **DB-023** `center_plans` — тарифы центров
- [ ] **DB-024** `specialist_connections` — подключения к пользователям

#### Таблицы социальной сети
- [ ] **DB-025** `posts` — публикации пользователей
- [ ] **DB-026** `post_likes` — лайки
- [ ] **DB-027** `post_comments` — комментарии
- [ ] **DB-028** `follows` — подписки
- [ ] **DB-029** `achievements` — достижения пользователей

### 1.2 Аутентификация и безопасность
- [ ] **AUTH-001** JWT аутентификация
- [ ] **AUTH-002** Google OAuth
- [ ] **AUTH-003** Telegram OAuth
- [ ] **AUTH-004** Роли: user, specialist, center, admin
- [ ] **AUTH-005** Middleware защиты роутов
- [ ] **AUTH-006** UserContext для всего приложения

**Файлы:**
- `server/middleware/auth.ts`
- `client/src/contexts/AuthContext.tsx` (переписать)
- `client/src/hooks/useAuth.ts`

---

## 🟡 ФАЗА 2: ПЛАТЕЖИ И ТОКЕНОМИКА (Недели 3-4)

### 2.1 Платежная система (БЕЗ юрлица)

#### Криптовалютные платежи (Приоритет #1)
- [ ] **CRYPTO-001** Интеграция с NOWPayments (принимает 100+ криптовалют)
- [ ] **CRYPTO-002** Интеграция с Coinbase Commerce
- [ ] **CRYPTO-003** Генерация крипто-адресов для оплаты
- [ ] **CRYPTO-004** Webhook обработчики платежей
- [ ] **CRYPTO-005** Страница оплаты криптой

#### Фиатные платежи (Обходные пути без юрлица)
- [ ] **FIAT-001** Patreon/Patreon-like система (подписки)
- [ ] **FIAT-002** Buy Me a Coffee / Ko-fi интеграция
- [ ] **FIAT-003** Stripe для тестов (личный аккаунт)
- [ ] **FIAT-004** YooKassa (когда будет ИП)

**Важно:** Все платежи конвертируются в Unity токены для внутренней экономики

### 2.2 Unity Токен (Офчейн)

#### Характеристики токена
- **Название:** Unity Token (UNITY)
- **Тип:** Офчейн (внутренний)
- **Эмиссия:** Неограниченная, контролируемая
- **Начальная цена:** $0.10 = 1 UNITY

#### Механика токена
- [ ] **TOKEN-001** Создание токена в системе
- [ ] **TOKEN-002** Автоматическая покупка токена при фиатном платеже
- [ ] **TOKEN-003** Выгода при оплате токенами: **скидка 15%**
- [ ] **TOKEN-004** Кэшбэк в токенах за активность
- [ ] **TOKEN-005** Реферальные бонусы в токенах

#### Примеры использования
| Операция | Фиат | Токены UNITY | Выгода |
|----------|------|--------------|--------|
| Basic подписка | $20 | 170 UNITY | Экономия $3 |
| Premium подписка | $50 | 425 UNITY | Экономия $7.50 |
| Консультация специалиста | $100 | 850 UNITY | Экономия $15 |

### 2.3 Автоматическая система выплат

#### Логика выплат
```
При оплате $50 (Premium):
├── 70% ($35) → Развитие платформы
├── 15% ($7.50) → Unity токен-резерв
├── 10% ($5) → Реферальные бонусы
└── 5% ($2.50) → Комиссия платформы
```

#### Выплаты партнерам
- [ ] **PAYOUT-001** Специалисты: получают 95% от оплаты (5% комиссия)
- [ ] **PAYOUT-002** Центры: настраиваемый % (10-25% комиссия)
- [ ] **PAYOUT-003** Магазины: фикс или % (настраивается)
- [ ] **PAYOUT-004** Автоматические выплаты еженедельно
- [ ] **PAYOUT-005** Выплаты в крипте (USDT/USDC) или UNITY

#### Настройки комиссий (каждый настраивает себе)
```typescript
interface CommissionSettings {
  type: 'percentage' | 'fixed';
  value: number; // % или фикс сумма
  minAmount?: number;
  maxAmount?: number;
  currency: 'USD' | 'UNITY' | 'USDT';
  autoPayout: boolean;
  payoutSchedule: 'daily' | 'weekly' | 'monthly';
  individualRates?: { // Индивидуальные условия
    userId: string;
    customRate: number;
  }[];
}
```

---

## 🟢 ФАЗА 3: ТАРИФЫ И ПЛАНЫ (Недели 5-6)

### 3.1 Тарифы для пользователей

#### Free ($0/мес)
**Модули:**
- ✅ 3 модуля здоровья (выбор: Движение, Питание, Сон)
- ❌ Медицина, Психология, Отношения, Привычки

**Функции:**
- Базовый дашборд
- Ручной ввод метрик
- Базовые графики
- Ограниченный ИИ-чат (5 сообщений/день)
- Социальная лента (только просмотр)

**Ограничения:**
- Макс. 3 привычки
- Нет экспорта данных
- Нет интеграции с wearables
- Реклама

#### Basic ($20/мес)
**Модули:**
- ✅ Все 7 модулей здоровья

**Функции:**
- Полный дашборд
- Все метрики и аналитика
- ИИ-чат (50 сообщений/день) — Qwen LLM
- 10 привычек
- Интеграция с 2 wearables
- Экспорт данных (PDF, CSV)
- Базовые CBT инструменты
- Без рекламы

**Кэшбэк:** 50 UNITY/мес

#### Premium ($50/мес)
**Модули:**
- ✅ Все 7 модулей + Premium функции

**Функции:**
- Всё из Basic
- Неограниченный ИИ-чат
- Неограниченные привычки
- Интеграция со всеми wearables
- Подключение специалистов (оплачивается отдельно)
- Персональный AI-планировщик
- Продвинутая аналитика
- Приоритетная поддержка
- Ранний доступ к новым фичам

**Кэшбэк:** 150 UNITY/мес
**Бонусы:** Доступ к закрытому сообществу

### 3.2 Тарифы для специалистов

#### Starter (Free)
- Профиль в каталоге
- До 5 активных подключений к пользователям
- Комиссия платформы: 15%
- Базовая аналитика

#### Professional ($30/мес)
- Всё из Starter
- Неограниченные подключения
- Комиссия платформы: 5% ⭐
- Продвинутая аналитика
- Виджет для сайта
- Приоритет в поиске

**Бонусы для специалистов:**
- Приведи 5 платящих пользователей → 1 мес бесплатно
- Приведи 10 пользователей → 3 мес бесплатно
- Приведи центр (спортзал, спа) → до 50% от корпоративной подписки

### 3.3 Тарифы для центров

#### Basic Center ($100/мес)
- Профиль центра
- До 10 сотрудников
- Базовое бронирование
- Комиссия: 15%

#### Premium Center ($300/мес)
- Всё из Basic
- Неограниченные сотрудники
- CRM система
- Комиссия: 10%
- White-label опция
- API доступ

#### Corporate ($1000/мес)
- Всё из Premium
- Неограниченные филиалы
- Персональный менеджер
- Комиссия: 5%
- Полная кастомизация

**Специальное предложение для специалистов:**
> Приведи центр → получай до 50% от его ежемесячной подписки

---

## 🔵 ФАЗА 4: AI-ЧАТ НА QWEN LLM (Недели 7-8)

### 4.1 Локальное развёртывание Qwen

#### Вариант 1: Бесплатные хостинги
- [ ] **AI-001** Hugging Face Spaces (бесплатный хостинг)
- [ ] **AI-002** Google Colab (для тестов)
- [ ] **AI-003** Kaggle Notebooks

#### Вариант 2: Дешёвые VPS
- [ ] **AI-004** Hetzner CX11 (€3.79/мес)
- [ ] **AI-005** DigitalOcean Droplet ($4/мес)
- [ ] **AI-006** Vultr Cloud ($2.50/мес)

#### Настройка Qwen
- [ ] **AI-007** Установка Qwen2.5-Instruct (7B или 14B)
- [ ] **AI-008** Настройка API сервера (vLLM или TGI)
- [ ] **AI-009** Система промптов для здоровья
- [ ] **AI-010** Контекст пользователя (история, метрики)
- [ ] **AI-011** Rate limiting по токенам

### 4.2 Интеграция с приложением
- [ ] **AI-012** AIChat.tsx — полный редизайн
- [ ] **AI-013** История сообщений в БД
- [ ] **AI-014** Streaming ответы
- [ ] **AI-015** Быстрые действия (quick actions)
- [ ] **AI-016** AI-виджет в дашборде

---

## 🟣 ФАЗА 5: СОЦИАЛЬНАЯ СЕТЬ (Недели 9-10)

### 5.1 Личная страница пользователя

#### Структура страницы (/u/:username)
```
┌─────────────────────────────────────────┐
│  [Cover Image]                          │
│  [Avatar] Имя Фамилия @username         │
│  Био...                                 │
│  [Подписчики: 1.2K] [Подписки: 500]     │
│  [Написать] [Подписаться]               │
├─────────────────────────────────────────┤
│  [Лента] [Достижения] [Статистика]     │
├─────────────────────────────────────────┤
│  📸 Публикация 1 (график прогресса)    │
│  🏆 Новое достижение!                   │
│  📊 Результаты месяца                   │
└─────────────────────────────────────────┘
```

#### Компоненты
- [ ] **SOCIAL-001** Профиль пользователя (обложка, аватар, био)
- [ ] **SOCIAL-002** Система подписок/отписок
- [ ] **SOCIAL-003** Лента публикаций (Instagram-style)
- [ ] **SOCIAL-004** Создание публикации (текст, фото, графики)
- [ ] **SOCIAL-005** Лайки, комментарии, репосты
- [ ] **SOCIAL-006** Достижения и бейджи
- [ ] **SOCIAL-007** Публикация результатов из дашборда

### 5.2 Достижения и геймификация
- [ ] **GAME-001** Система достижений
- [ ] **GAME-002** Награды за стрики
- [ ] **GAME-003** Таблицы лидеров
- [ ] **GAME-004** Челленджи между пользователями

---

## ⚫ ФАЗА 6: СТРАНИЦА ОФФЕРА ДЛЯ СПЕЦИАЛИСТОВ (Недели 11-12)

### 6.1 Страница /specialist-offer

#### Секции страницы
1. **Hero:** "Зарабатывайте на своей экспертизе"
2. **Преимущества:**
   - Доход 95% от консультаций
   - Готовая база клиентов
   - Автоматические выплаты
   - Продвинутая аналитика

3. **Калькулятор дохода:**
   ```
   10 клиентов × $50 × 95% = $475/мес
   50 клиентов × $50 × 95% = $2,375/мес
   ```

4. **Бонусная программа:**
   - Приведи 5 пользователей → 1 мес бесплатно
   - Приведи центр → до 50% от подписки центра

5. **Отзывы специалистов**
6. **Форма регистрации**

### 6.2 Страница /center-offer
- Аналогичная структура для центров
- Акцент на CRM и управлении сотрудниками

---

## 📋 ПОРЯДОК РЕАЛИЗАЦИИ (По приоритету)

### Неделя 1 (Сейчас)
1. ✅ Обновить TODO план (сделано)
2. 🔄 Настроить Supabase + таблицы
3. 🔄 Реализовать JWT аутентификацию
4. 🔄 Обновить UserContext

### Неделя 2
5. 🔄 Интегрировать Qwen LLM (Hugging Face)
6. 🔄 Переписать AIChat.tsx (убрать mock)

### Неделя 3
7. 🔄 Настроить крипто-платежи (NOWPayments)
8. 🔄 Создать Unity токен
9. 🔄 Система автоматических выплат

### Неделя 4
10. 🔄 Страницы тарифов (/pricing)
11. readcrumbs Checkout процесс
12. 🔄 Страница биллинга

### Неделя 5
13. 🔄 Тарифы для специалистов
14. 🔄 Страница /specialist-offer
15. 🔄 Регистрация специалистов

### Неделя 6
16. 🔄 Тарифы для центров
17. 🔄 Страница /center-offer
18. 🔄 CRM для центров

### Неделя 7
19. 🔄 Личная страница пользователя (/u/:username)
20. 🔄 Лента публикаций
21. 🔄 Система подписок

### Неделя 8
22. 🔄 Достижения и бейджи
23. 🔄 Публикация результатов из дашборда
24. 🔄 Комментарии и лайки

### Неделя 9-10
25. 🔄 Полноценные модули здоровья (ввод данных)
26. 🔄 Интеграция с wearables

### Неделя 11-12
27. 🔄 Убрать ВСЕ демо-данные
28. 🔄 Тестирование
29. 🔄 Подготовка к запуску

---

## 💰 ФИНАНСОВАЯ МОДЕЛЬ (Пересчитанная)

### Прогноз доходов (год 1)

#### Пользователи
| План | Цена | Пользователи | Доход/мес |
|------|------|--------------|-----------|
| Free | $0 | 50,000 | $0 |
| Basic | $20 | 2,000 | $40,000 |
| Premium | $50 | 500 | $25,000 |
| **Итого** | | | **$65,000/мес** |

#### Специалисты
| План | Цена | Специалисты | Доход/мес |
|------|------|-------------|-----------|
| Starter | $0 | 500 | $0 |
| Professional | $30 | 200 | $6,000 |
| **Итого** | | | **$6,000/мес** |

#### Центры
| План | Цена | Центры | Доход/мес |
|------|------|--------|-----------|
| Basic | $100 | 50 | $5,000 |
| Premium | $300 | 20 | $6,000 |
| Corporate | $1000 | 5 | $5,000 |
| **Итого** | | | **$16,000/мес** |

### Комиссии
| Источник | Объем | Комиссия | Доход/мес |
|----------|-------|----------|-----------|
| Специалисты | $100,000 | 5% | $5,000 |
| Центры | $200,000 | 10-15% | $25,000 |
| Магазины | $50,000 | 5% | $2,500 |
| **Итого** | | | **$32,500/мес** |

### ИТОГО (Год 1)
- **MRR:** $119,500
- **ARR:** $1,434,000

---

## ✅ ЧЕКЛИСТ ГОТОВНОСТИ

### Перед запуском MVP
- [ ] Все таблицы в БД созданы
- [ ] Аутентификация работает
- [ ] AI-чат на Qwen (без mock)
- [ ] Крипто-платежи работают
- [ ] Unity токен функционирует
- [ ] Тарифы и оплата работают
- [ ] Нет демо-данных в production

### Beta
- [ ] Все 7 модулей здоровья
- [ ] Специалисты могут подключаться
- [ ] Центры могут регистрироваться
- [ ] Социальная сеть работает
- [ ] Автоматические выплаты

---

## 🚀 НАЧИНАЕМ РЕАЛИЗАЦИЮ!

**Сейчас:** Перехожу к реализации Фазы 1 (Supabase + Аутентификация)
