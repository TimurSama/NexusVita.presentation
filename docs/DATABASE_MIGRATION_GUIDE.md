# Руководство по миграции базы данных для Vercel

## Текущая ситуация

### Локально (работает ✅)
- **База данных**: SQLite (`data/ethoslife.db`)
- **Регистрация**: `/api/auth/register` - работает
- **Вход**: `/api/auth/login` и `/api/auth/telegram-auth` - работают
- **Данные Марии**: Создаются автоматически при запуске сервера

### На Vercel (НЕ работает ❌)
- **Проблема**: SQLite не работает на serverless функциях
- **Результат**: 
  - База данных не создается
  - Регистрация и вход не работают
  - Данные не сохраняются
  - Данные Марии недоступны

## Решение: Миграция на Supabase (Postgres)

### Шаг 1: Создать базу данных Supabase

1. Перейдите на https://supabase.com
2. Создайте аккаунт (бесплатный)
3. Создайте новый проект
4. Получите connection string:
   - Settings → Database → Connection string
   - Скопируйте "Connection string" (URI format)

### Шаг 2: Установить зависимости

```bash
pnpm add pg @types/pg
```

### Шаг 3: Настроить переменные окружения

В Vercel Dashboard:
1. Settings → Environment Variables
2. Добавьте:
   - `DATABASE_URL` = ваш connection string из Supabase

### Шаг 4: Обновить код

Я уже создал файл `server/database-postgres.ts` с адаптером для Postgres.

Нужно обновить `server/index.ts` и другие файлы для использования правильной БД:

```typescript
// В server/index.ts
import { initDatabase } from './database-adapter'; // Использует адаптер
```

### Шаг 5: Мигрировать данные Марии

После настройки Postgres, нужно:
1. Создать профиль Марии в новой БД
2. Загрузить документ
3. Создать месячный план

## Альтернатива: Vercel Postgres

Если хотите использовать встроенный Postgres от Vercel:

1. Vercel Dashboard → Storage → Create Database → Postgres
2. Получите connection string
3. Добавьте в Environment Variables как `POSTGRES_URL`

## Что происходит с данными Марии

### Локально:
- Данные хранятся в `data/ethoslife.db`
- Создаются автоматически при запуске сервера
- Включают:
  - Профиль (рост, вес, дата рождения)
  - Документ "Комплексное исследование..."
  - Месячный план упражнений
  - Настройки Telegram бота

### На Vercel (после миграции):
- Данные будут храниться в Postgres
- Нужно создать скрипт миграции для переноса данных Марии
- Или создать заново при первом запуске

## Рекомендация

Для быстрого старта рекомендую **Supabase**:
- Бесплатный тариф достаточен для начала
- Простая настройка
- Хорошая документация
- Встроенная аутентификация (можно использовать позже)
